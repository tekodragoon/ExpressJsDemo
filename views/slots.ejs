<!DOCTYPE html>
<html lang="en">
<%- include("_head", {documentTitle: "home" }); %>
<body>
  <%- include("_nav", {currentUser: locals.user}); %>
  <%- include("_formatDate"); %>
  <% if (messages.info) { %>
    <div class="info flash"> <%= messages.info %> </div>
  <% } %>
  <% if (messages.error) { %>
    <div class="error flash"> <%= messages.error %> </div>
  <% } %>
  <h1>Slots</h1>
  <div class="slots-top-actions">
    <div class="slot-top-btn">
      <a href="/slots?date=<%= reqDate(monday, false) %>"><<</a>
    </div>
    <div class="slot-top-date" id="week"><%= shortDate(monday) %> - <%= shortDate(friday) %> </div>
    <div class="slot-top-btn">
      <a href="/slots?date=<%= reqDate(monday, true) %>">>></a>
    </div>
  </div>
  <div class="slots-group">
    <% for(let i = 0; i < 5; i++) { %>
      <div class="slots">
        <div class="slots-day-group">
          <div class="slots-date"><%= nextStringDate(monday, i) %></div>
          <% locals.slots.forEach((slot) => { %>
            <% if (compareDate(slot.date, nextDate(monday, i))) { %>
              <div class="slot-info">
                <div class="slot-info-title">
                  <span><%= slot.title %></span>
                  <button class="btn-small">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path fill="#ffffff" d="M495 59.6C516.9 81.47 516.9 116.9 495 138.8L182.3 451.6C170.9 462.9 156.9 471.2 141.5 475.8L20.52 511.4C14.9 513 8.827 511.5 4.687 507.3C.5466 503.2-1.002 497.1 .6506 491.5L36.23 370.5C40.76 355.1 49.09 341.1 60.44 329.7L373.2 16.97C395.1-4.897 430.5-4.897 452.4 16.97L495 59.6zM341 94.4L417.6 170.1L472.4 116.2C481.8 106.8 481.8 91.6 472.4 82.23L429.8 39.6C420.4 30.23 405.2 30.23 395.8 39.6L341 94.4zM318.4 117L83.07 352.4C75.5 359.9 69.95 369.3 66.93 379.6L39.63 472.4L132.4 445.1C142.7 442.1 152.1 436.5 159.6 428.9L394.1 193.6L318.4 117z"/></svg>
                  </button>
                  <div class="hidden"><%= slot.startHour %>&<%= slot.endHour %>&<%= slot.peopleLimit %>&<%= slot._id %>&<%= formatInputDate(slot.date) %></div>
                </div>
                <div><%= slot.startHour %> - <%= slot.endHour %></div>
                <div><%= slot.peopleLimit %> seat<%= slot.peopleLimit > 1 ? 's' : '' %></div>
              </div>
            <% } %> 
          <% }); %>
          <div class="slots-date-actions">
            <div>
              <button class="slot-add-btn" id="slot-<%= i %>">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path fill="#ffffff" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/></svg>
              </button>
              <span class="hidden"><%= formatInputDate(nextDate(monday, i)) %></span>
            </div>
          </div>
        </div>
      </div>
    <% } %> 
  </div>
  <dialog class="formDialog" id="slot-dialog">
    <form class="util-form" method="post" id="slot-form" novalidate>
      <fieldset>
        <legend>Slot information</legend>
        <input type="hidden" name="date" id="create-slot-date">
        <input type="hidden" name="_id" id="update-slot-id">
        <div>
          <label for="title">Title</label>
          <input type="text" name="title" id="title" required minlength="5">
          <div class="error-field" aria-live="polite" id="title-err-fld"></div>
        </div>
        <div>
          <label for="startHour">Start Time</label>
          <div class="input-clock-bloc">
            <input class="input-clock" type="number" name="startHour" id="startHour" min="9" max="18" step="1" required value="09">
            <input class="input-clock" type="number" name="startMin" id="startMin" min="0" max="30" step="30" required value="00">
          </div>
          <div class="error-field" aria-live="polite" id="time-err-fld"></div>
        </div>
        <div>
          <label for="duration">Duration</label>
          <input type="number" name="duration" id="duration" min="1" max="4" step="1" required value="1">
          <div class="error-field" aria-live="polite" id="duration-err-fld"></div>
        </div>
        <div>
          <label for="peopleLimit">Seats</label>
          <input type="number" name="peopleLimit" id="peopleLimit" min="1" max="30" step="1" required value="1">
          <div class="error-field" aria-live="polite" id="people-err-fld"></div>
        </div>
        <button class="btn" id="cancel-slot" type="button">Cancel</button>
        <button class="btn" id="valid-slot" type="submit">Valid</button>
        <div class="error-field" aria-live="polite" id="form-err-fld"></div>
      </fieldset>
    </form>
  </dialog>
</body>
<script src="/js/slots.js" type="module"></script>
</html>